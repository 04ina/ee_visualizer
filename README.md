ee_visualizer -- утилита для визуализации данных, полученных с помощью расширения СУБД PostgreSQL [extended_explain](https://github.com/04ina/extended_explain). Визуализирует в удобном виде все пути (узлы), которые оптимизатор/планировщик перебирал в процессе поиска наилучшего плана исполнения запроса. 

![Главный экран](images/1.png)

Содержание:

1. [Как запустить](#как-запустить)
2. [Как использовать](как-использовать)

# Как запустить

Копируем репозиторий

```sh
git clone https://github.com/04ina/extended_explain.git
```


Делаем дамп нужного запроса из таблицы ee.paths

```sql
COPY ee.paths TO '/directory/paths.csv'
```

Если в таблице ee.paths несколько запросов, то делаем дамп путей с указанием соответствующего query_id

```sql
COPY (SELECT * FROM ee.paths WHERE query_id = 1) TO '/directory/paths.csv'
```

Конвертируем полученный csv дамп в файл data.json с помощью скрипта csv_to_json.py

```sh
python3 csv_to_json.py /directory/tpcds1.csv > data.json
```

Запускаем локальный сервер на порте 8000. Файл data.json должен быть в одной директории с index.html

```sh
python3 -m http.server 8000
```

Далее в браузере запускаем утилиту по адресу http://localhost:8000

# Как использовать 

Визуализация представлена в виде трех окон:

1. Интерактивное дерево всех путей, которое находится в левой части экрана. Состоит из подзапросов, уровней, абстрактных отношений (base rel (level = 1), join rel, upper (level = 0) rel), и путей. Изначально видны лишь подзапросы, но при нажатии можно увидеть низлежащие по иерархии объекты. Все связанные пути для удобства соединены ребрами. Если нажать на путь, то желтым цветом подсветятся все низлежащие дочерние пути. Если при зажатом CTRL нажать ЛКМ по абстрактному отношению, то появится окно фильтрации путей по названию. Сбросить фильтрацию можно либо очищением фильтра в сплывающем окне, либо посредством кнопки "сбросить фильтры" в левой верхней части экрана. Помимо этого есть кнопка "Сбросить вид", которая возвращает камеру в центр графа, а также кнопка "Свернуть дерево", которая сворачивает все объекты дерева. 

2. Лучший план, который выбрал планировщик. Расположен в правой верхней части экрана. Имеет схожую с EXPLAIN структуру. При нажатии на узел подсвечивается соответствующий объект дерева, где находится данный путь; таким образом можно найти нужный путь в дереве, даже если дерево не полностью развернуто. Помимо этого в таблице альтернативных путей высвечиваются все альтернативные пути выбранного узла (Непосредственно выбранный узел подсвечивается синим в таблице).

3. Таблица альтернативных путей. Расположена в правой нижней части экрана. Выводит в виде таблицы формата ee.paths все пути, являющиеся альтернативными по отношению к выбранному пути. Таблица имеет поиск, а также сортировку по столбцам. Для сортировки по возрастанию/убыванию необходимо нажать на название соответствующей колонки. При нажатии на запись таблицы в дереве путей будет отмечен объект, в котором находится данный путь (или сам путь, если нужные вышестоящие объекты уже раскрыты).

При необходимости размеры каждого окна можно изменить.

Чтобы протестировать функционал утилиты, поместите файл репозитория example/data.json в одну директорию с файлом index.html (корневая директория репозитория). 

